---
title: 'Arbeitsbeispiel: Die Blockchain mit dem React-Kontext synchronisieren'
date: '2023-12-15'
lastmod: '2023-12-15'
tags: ['Web3']
draft: false
summary: 'Ein Beispiel für die Synchronisation zwischen einer Blockchain und einer React-'
images: [/static/images/MeOnWeb3.png]
authors: ['default']
---

![](/static/images/MeOnWeb3.png)

Dies ist der dritte Teil meiner Serie über MetaMask, Ethers und React.

Das Ergebnis meiner Bemühungen, die Blockchain mit diesem Blog
zu synchronisieren, sieht man [hier](/ethereum). Es wird jeweils
die Blocknummer des letzten empfangenen Blocks angegeben,
und dessen Zeitstempel.

Wer eine Weile andächtig zuschaut, ob dies wirklich eine dynamische
Anzeige ist, wird feststellen, dass Blocknummern gelegentlich
übersprungen werden. Die Blockchain (die man zuvor in MetaMask ausgewählt
hat) ist also schneller.

Was steckt dahinter?

Das Zeitintervall für die Synchronisierung ist auf 12'000 Millisekunden
eingestellt. Es dauert also zwölf Sekunden, bevor MetaMask den neuesten
Block anfordert. Wenn in dieser Zeit mehrere Blöcke erstellt worden
sind, dann gibt es Sprünge in der Anzeige.

Und jetzt zurück zum Quellcode. 😀

Beim letzten Mal hatte ich erklärt, dass der React-Kontext verwendet
werden kann, um sich ändernde Informationen für viele Komponenten
in der Anzeige einfach verfügbar zu machen. Wie das passieren
kann, sehen wir [hier](https://github.com/lyrx/tailwind/blob/main/app/context/ContextProvider.tsx).

Es gibt also ein Polling, das so implementiert ist:

```tsx
useEffect(() => {

    // Define a function to fetch the block number
    const fetchLastBlock = () => web3Provider?.getBlock('latest').then((b) => setLastBlock(b))

    // Fetch the block number immediately on component mount
    fetchLastBlock()

    // Set up an interval to fetch the block number every 12 seconds
    const interval = setInterval(fetchLastBlock, 12000)

    // Clean up the interval when the component unmounts
    return () => clearInterval(interval)
  }, [])
```

Und so wird der Kontext dann verwendet, um die (halbwegs) aktuelle Blocknummer anzuzeigen.

```tsx
const LastBlockNumber: React.FC = () => {
  const context = useContext(Context)
  return (
    <span>
      {context.ethersProvider?.lastBlock
        ? context.ethersProvider.lastBlock.number.toString()
        : '--'}
    </span>
  )
}
```

Das ist gar nicht so kompliziert, nicht wahr? 😁

Das war's für heute! Viel Spass beim verdauen! Beim nächsten Mal gibt noch etwas
mehr Infos darüber, wie sich React mit MetaMask synchronisiert (oder auch nicht) ...
