---
title: 'Arbeitsbeispiel: Die Blockchain mit dem React-Kontext synchronisieren'
date: '2023-12-15'
lastmod: '2023-12-15'
tags: ['Web3']
draft: false
summary: 'Ein Beispiel fÃ¼r die Synchronisation zwischen einer Blockchain und einer React-'
images: [/static/images/MeOnWeb3.png]
authors: ['default']
---

![](/static/images/MeOnWeb3.png)

Dies ist der dritte Teil meiner Serie Ã¼ber MetaMask, Ethers und React.

Das Ergebnis meiner BemÃ¼hungen, die Blockchain mit diesem Blog
zu synchronisieren, sieht man [hier](/ethereum). Es wird jeweils
die Blocknummer des letzten empfangenen Blocks angegeben,
und dessen Zeitstempel.

Wer eine Weile andÃ¤chtig zuschaut, ob dies wirklich eine dynamische
Anzeige ist, wird feststellen, dass Blocknummern gelegentlich
Ã¼bersprungen werden. Die Blockchain (die man zuvor in MetaMask ausgewÃ¤hlt
hat) ist also schneller.

Was steckt dahinter?

Das Zeitintervall fÃ¼r die Synchronisierung ist auf 12'000 Millisekunden
eingestellt. Es dauert also zwÃ¶lf Sekunden, bevor MetaMask den neuesten
Block anfordert. Wenn in dieser Zeit mehrere BlÃ¶cke erstellt worden
sind, dann gibt es SprÃ¼nge in der Anzeige.

Und jetzt zurÃ¼ck zum Quellcode. ğŸ˜€

Beim letzten Mal hatte ich erklÃ¤rt, dass der React-Kontext verwendet
werden kann, um sich Ã¤ndernde Informationen fÃ¼r viele Komponenten
in der Anzeige einfach verfÃ¼gbar zu machen. Wie das passieren
kann, sehen wir [hier](https://github.com/lyrx/tailwind/blob/main/app/context/ContextProvider.tsx).

Es gibt also ein Polling, das so implementiert ist:

```tsx
useEffect(() => {

    // Define a function to fetch the block number
    const fetchLastBlock = () => web3Provider?.getBlock('latest').then((b) => setLastBlock(b))

    // Fetch the block number immediately on component mount
    fetchLastBlock()

    // Set up an interval to fetch the block number every 12 seconds
    const interval = setInterval(fetchLastBlock, 12000)

    // Clean up the interval when the component unmounts
    return () => clearInterval(interval)
  }, [])
```

Und so wird der Kontext dann verwendet, um die (halbwegs) aktuelle Blocknummer anzuzeigen.

```tsx
const LastBlockNumber: React.FC = () => {
  const context = useContext(Context)
  return (
    <span>
      {context.ethersProvider?.lastBlock
        ? context.ethersProvider.lastBlock.number.toString()
        : '--'}
    </span>
  )
}
```

Das ist gar nicht so kompliziert, nicht wahr? ğŸ˜

Das war's fÃ¼r heute! Viel Spass beim verdauen! Beim nÃ¤chsten Mal gibt noch etwas
mehr Infos darÃ¼ber, wie sich React mit MetaMask synchronisiert (oder auch nicht) ...
